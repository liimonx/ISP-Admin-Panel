import pytest
from rest_framework.test import APIClient
from django.contrib.auth import get_user_model

User = get_user_model()

@pytest.mark.django_db
def test_sensitive_data_exposure_in_logs(capfd):
    """
    Test that sensitive data (password) is not exposed in debug logs during login.
    """
    client = APIClient()
    username = "testuser"
    password = "sensitive_password_123"

    # Create a user
    User.objects.create_user(username=username, password=password)

    # Login URL
    url = "/api/auth/login/"

    # Make the request
    response = client.post(url, {"username": username, "password": password}, format='json')

    # Capture stdout/stderr
    out, err = capfd.readouterr()

    # Check if password is in the logs
    # This assertion should fail if the vulnerability is present
    assert password not in out, "SECURITY VULNERABILITY: Password found in logs!"
    assert "Request body:" not in out, "Debug statement 'Request body' should be removed"
